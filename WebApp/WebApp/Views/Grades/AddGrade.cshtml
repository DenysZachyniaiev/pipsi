@model WebApp.Models.Grade

@{
    ViewData["Title"] = "Add Grade";
    var students = ViewBag.Students as List<WebApp.Models.Student>;
    var className = ViewBag.ClassName as string;
    var subjects = ViewBag.Subjects as List<WebApp.Models.Subject>;
    var teacherSubject = ViewBag.TeacherSubject as WebApp.Models.Subject;
    var user = Context.User;
    var isAdmin = user.IsInRole("Admin");
}

<h3>Add Grade for @className</h3>

<form asp-action="AddGrade" method="post">
    <input type="hidden" name="className" value="@className" />

    <div class="mb-3">
        <label for="StudentId" class="form-label">Student:</label>
        <select name="StudentId" class="form-select" required>
            <option value="">-- select student --</option>
            @foreach (var s in students)
            {
                <option value="@s.Id">@s.FirstName @s.LastName</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label for="SubjectName" class="form-label">Subject:</label>

        @if (isAdmin)
        {
            <select name="SubjectName" class="form-select" required>
                <option value="">-- select subject --</option>
                @foreach (var subject in subjects)
                {
                    <option value="@subject.Name">@subject.Name</option>
                }
            </select>
        }
        else if (teacherSubject != null)
        {
            <input type="text" name="SubjectName" class="form-control" value="@teacherSubject.Name" readonly />
        }
        else
        {
            <div class="alert alert-warning">
                You are not assigned to any subject in this class.
            </div>
        }
    </div>

    <div class="mb-3">
        <label for="Value" class="form-label">Grade (1–6):</label>
        <select name="Value" class="form-select" required>
            @for (int i = 1; i <= 6; i++)
            {
                <option value="@i">@i</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label for="Date" class="form-label">Date:</label>
        <input type="date" name="Date" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")" required />
    </div>

    <button type="submit" class="btn btn-success">Save Grade</button>
    <a asp-action="ManageGrades" asp-route-className="@className" class="btn btn-secondary ms-2">Cancel</a>
</form>